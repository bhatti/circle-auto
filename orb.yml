version: 2.1
description: CircleCI orb for NowSecure AUTO that provides fully automated, mobile
  appsec testing coverage
executors:
  default:
    description: Java docker container to use when running the NowSecure AUTO orb
    docker:
    - image: circleci/openjdk:8-jdk-node
    environment:
      TERM: dumb
commands:
  sectest:
    description: Executes security test using NowSecure AUTO.
    parameters:
      auto_url:
        type: string
        default: https://lab-api.nowsecure.com
      auto_token:
        type: string
        default: $AUTO_TOKEN
      auto_group:
        type: string
        default: $AUTO_GROUP
      auto_file:
        type: string
      auto_wait:
        type: string
        default: "30"
      auto_score:
        type: string
        default: "50"
    steps:
    - attach_workspace:
        at: /tmp/workspace
    - checkout
    - run: gradle run -Dauto.url=<< parameters.auto_url >> -Dauto.token=<< parameters.auto_token >> -Dauto.file=<< parameters.auto_file >> -Dauto.group=<< parameters.auto_group >> -Dauto.wait=<< parameters.auto_wait >> -Dauto.score=<< parameters.auto_score >>
    - persist_to_workspace:
        root: /tmp/workspace
        paths:
        - nowsecure-auto-security-test/*
    - store_artifacts:
        path: /tmp/workspace/nowsecure-auto-security-test
        destination: nowsecure-auto-security-test
